# インテグレーションテスト方針

## 目的
本アプリケーションの主要なコンポーネント（DB、外部ファイル、外部サービス、出力処理など）が連携して正しく動作し、期待通りの出力ファイルが生成されることを検証する。

## テスト対象範囲

- DB接続・初期化処理
- OneDriveリフレッシュ処理（必要時）
- Gmail経由の約定履歴リスト更新
- 各種リスト（約定履歴、ウォッチリスト、マスタリスト、方針リスト）の取得
- 外部サイトからの情報取得・反映
- 出力ファイル生成（Alert.SaveFile）
- メール送信（Alert.SendGmailViaSmtp、必要時）

## テスト手順

1. **テスト用環境の準備**
    - テスト用DBまたはモックDBの用意
    - テスト用入力ファイル（例: `execution_test.xlsx`, `watchlist_test.xlsx` など）の配置
    - 必要に応じて外部サービスのモック化やテスト用設定値の適用

2. **アプリケーションの実行**
    - テストプロジェクトから `Program.Main` を呼び出す
    - 依存する外部リソースがテスト用であることを確認

3. **出力ファイルの検証**
    - 出力ファイル（例: `output.xlsx` や `output.csv`）の存在確認
    - ファイル内容（ヘッダー、レコード数、特定の値など）の妥当性検証

4. **副作用の検証**
    - メール送信やDB更新など、外部への副作用が期待通りかを確認
    - テスト後に副作用をリセット・クリーンアップ

## テスト例（xUnit + CSVの場合）

    using System.IO;
    using System.Threading.Tasks;
    using Xunit;

    public class IntegrationTests
    {
        [Fact]
        public async Task 入力値から出力ファイルが妥当であることをインテグレーションテストする()
        {
            // 1. テスト用入力ファイルを準備

            // 2. 設定値をテスト用に差し替え

            // 3. アプリケーションをコール
            await ConsoleApp1.Program.Main(new string[0]);

            // 4. 出力ファイルの検証
            var outputPath = "output.csv";
            Assert.True(File.Exists(outputPath), "出力ファイルが存在しません");

            var lines = File.ReadAllLines(outputPath);
            Assert.True(lines.Length > 1, "出力ファイルにデータがありません");
            Assert.Contains("Code", lines[0]);
            Assert.Contains("Name", lines[0]);
        }
    }

## 備考
- Excelの場合は `ClosedXML` などのライブラリを利用して内容を検証する。
- テスト用データや出力ファイルのパスは、実際の環境に合わせて調整すること。
- 外部サービスとの連携部分は、必要に応じてモックやスタブを利用し、テストの安定性を確保する。