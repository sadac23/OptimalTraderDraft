# 外部情報取得欠落の調査まとめ

## 現象
- ウォッチリストの銘柄を順番に処理中、あるタイミングから全銘柄で外部サイトからの情報取得が欠落する。
- 欠落時、取得値はnullや空文字となる。
- エラーログや警告は出力されず、アプリは正常終了する。

## 主な原因候補
1. **外部接続や認証のグローバルな失敗**
   - APIキーの期限切れ、IPブロック、セッション切れ等で以降の取得が全て失敗する可能性。

2. **例外が握りつぶされている**
   - 取得処理で例外が発生してもcatchされず、何も出力されない。

3. **状態の共有・副作用**
   - グローバル変数やシングルトン、静的プロパティの不正な状態が波及している可能性。

4. **非同期処理の問題**
   - await漏れや、タスクの例外が表面化しないまま処理が進んでいる。

## Updaterクラスの実装調査
- `JapaneseStockUpdater`、`JapaneseETFUpdater`、`IndexUpdater` の `UpdateFromExternalSourceAsync` では、複数の外部スクレイピング処理を `Task.Run` で並列実行し、`Task.WhenAll` で待機している。
- いずれも**try-catchによる例外処理がなく、失敗時に何も出力されない**。
- 失敗時はプロパティがnullや空文字のままとなる。

## 改善案
- 各Task内でtry-catchし、catch時に必ずログ出力する。
- 失敗時は明示的に例外をthrowし、上位で検知・通知する。
- 必要に応じてリトライ処理を追加する。

---